# Orchestration Log: Amos — Airflow Deployment (Task #81)

**Date:** 2026-02-25 14:48 UTC  
**Agent:** Amos (gpt-5.2-codex)  
**Mode:** background  
**Task:** Issue #81 — Airflow deployment on AKS  
**Outcome:** SUCCESS (cross-branch dependency on keycloak vars)

## Files Created
- `platform/helm_airflow.tf` — Helm release for Apache Airflow chart (apache-airflow/airflow) with:
  - External Redis backend (`redis-master.redis.svc.cluster.local:6379`)
  - External PostgreSQL (`postgresql-rw.postgresql.svc.cluster.local:5432`, database `airflow`)
  - AKS safeguards compliance (probes, resources, seccomp)
  - Stateful node scheduling with tolerations/affinity
  - Istio PeerAuthentication for mTLS

## Files Updated
- `platform/variables.tf` — Added Airflow input variables:
  - `airflow_admin_password` (sensitive string)
  - `airflow_image_tag` (string, pinned version)
  - `airflow_fernet_key` (sensitive string)
  - `airflow_webserver_secret_key` (sensitive string)

## Decision Record
- File: `.squad/decisions/inbox/amos-airflow-comparison.md`
- Title: "Airflow Deployment Comparison (Issue #81)"
- Summary: Use official Apache Airflow chart with external Redis/PostgreSQL backends to align with AKS patterns

## PR Opened
- #133 — "feat: Add Airflow scheduler and webserver"

## Notes
- Uses apache-airflow/airflow chart from `https://airflow.apache.org`
- DAGs loaded from ConfigMap or persistent volume (configurable)
- KubernetesExecutor for task scaling
- Fernet + webserver keys generated in Terraform as sensitive outputs
- NOTE: Cross-branch dependency on keycloak variables in platform/variables.tf
  - `terraform validate` fails until keycloak PR (#134) is merged
  - Resolution: Merge #134 first, then rebase #133
